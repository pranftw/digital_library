{% extends 'main.html' %}

{% block css_imports %}
{% endblock css_imports %}

{% block content %}
  <div style="height:20px;"></div>
    {% if current_user.is_admin==False %}
      {% if current_user.is_authenticated==False %}
        <a href="{{ url_for('login') }}">Login</a>
        <a href="{{ url_for('register') }}">Register</a>
      {% else %}
        <a href="{{ url_for('search') }}">Search Books</a>
        <a href="{{ url_for('explore_links') }}">Explore</a>
        <br>
        <br>

        <h2>FINE TO BE PAID: {{ fine }}</h2>

        <h2>ISSUED</h2>
        <div class="books_grid">
          {% for i,book in enumerate(books) %}
            <div class="book">
              <img class="book_img" src="{{ book.img_url }}">
              <h5>ID: {{ book.id }}</h5>
              <h5>TITLE: {{ book.title }}</h5>
              <h5>AUTHOR: {{ book.author }}</h5>
              <h5>STOCKS: {{ book.stocks }}</h5>
              <h5>DUE DATE: {{ due_dates[i] }}</h5>
              <form method="post" action="{{ url_for('transact',book_id=book['id']) }}">
                <button>RETURN</button>
              </form>
            </div>
          {% endfor %}
        </div>

        <h2>WATCHLIST</h2>
        <div class="books_grid">
          {% for i,book in enumerate(watchlist_books) %}
            <div class="book">
              <img class="book_img" src="{{ book.img_url }}">
              <h5>ID: {{ book.id }}</h5>
              <h5>TITLE: {{ book.title }}</h5>
              <h5>AUTHOR: {{ book.author }}</h5>
              {% if book.stocks!=0 %}
                <form method="post" action="{{ url_for('transact',book_id=book.id) }}">
                  <button>ISSUE</button>
                </form>
              {% endif %}
            </div>
          {% endfor %}
        </div>

        <h2>REQUEST BOOK</h2>
          <form method="post" action="{{ url_for('request_book') }}">
            <label for="title">Title</label>
            <input name="title" type="text" required maxlength="40"><br>
            <label for="author">Author</label>
            <input name="author" type="text" required maxlength="40"><br>
            <button>SUBMIT</button>
          </form>

      {% endif %}
    {% else %}
        {% if current_user.is_authenticated==True %}
          <a href="{{ url_for('search') }}">Search Books</a>
          <a href="{{ url_for('explore_links') }}">Explore</a>
          <br>
          <br>
          
          <h2>ADD BOOK</h2>
          <form method="post" action="{{ url_for('add_book') }}">
            <label for="title">Title</label>
            <input name="title" type="text" required maxlength="40"><br>
            <label for="author">Author</label>
            <input name="author" type="text" required maxlength="40"><br>
            <label for="subject">Subject</label>
            <input name="subject" type="text" required maxlength="40"><br>
            <label for="sem">Semester</label>
            <input name="sem" type="text" required maxlength="40"><br>
            <label for="stocks">Stocks</label>
            <input name="stocks" type="number" required maxlength="40"><br>
            <label for="img_url">Image URL</label>
            <input name="img_url" type="text" required><br>
            <button>SUBMIT</button>
          </form>

          <h2>REQUESTS</h2>
          <div class="books_grid">
            {% for br in book_requests %}
              <div class="book">
                <h5>TITLE: {{ br.title }}</h5>
                <h5>AUTHOR: {{ br.author }}</h5>
                <br>
                <form method="post" action="{{ url_for('delete_request',request_id=br.id) }}">
                  <button>DELETE</button>
                </form>
              </div>
            {% endfor %}
          </div>

        {% else %}
          <a href="{{ url_for('login') }}">Login</a>
          <a href="{{ url_for('register') }}">Register</a>
        {% endif %}
    {% endif %}
  <div style="height:20px;"></div>
{% endblock content %}

{% block js_imports %}
{% endblock js_imports %}
